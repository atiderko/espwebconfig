<!DOCTYPE html>
<html lang="en">

  <head>
    <meta name="viewport" charset="UTF-8" content="width=device-width, initial-scale=1, user-scalable=yes">
    <title>Bewaesserungsteuerung</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/bbsicons.css">
  </head>

  <body style="padding-top:58px;">
    <div id="header"></div>
    <div class="base-panel">
      <br>
      <span id="bbs_title" style="font-weight: bold; font-size: 2em;">ESP_1</span>
      <span id="version">Unknown</span>

      <div id="cycle1_group" class="noorder">
        <div class="line_named" >cycle1</div>
        <div style="display: inline-flex;">
          <div class="img-moisture">
            <p id="cycle1_moisture" style="margin-top:13px;padding-right:15px;font-size:120%;"></p>
          </div>
          <div class="img-flowerbox" style="margin:0px 10px 0 10px;">
            <p id="cycle1_flowerbox" style="margin-bottom:0;padding:28px 0 0 0;font-size:120%;"></p>
            <p id="cycle1_flowerbox_sensor" style="margin-top:-5px;font-size:60%;"></p>
          </div>
          <div class="img-canister">
            <p id="cycle1_canister" style="margin-bottom:0;padding:42px 0 0 0;font-size:120%;"></p>
            <p id="cycle1_canister_sensor" style="margin-top:-5px;font-size:60%;"></p>
          </div>
        </div>
        <br>
        <div style="display: inline-flex;padding:10px 0px 0px 0px;">
          <div class="img-pump"></div>
          <div>
            <div id="cycle1_pump_on" style="display:inline-flex;padding:2px 0 2px;font-size:120%;"></div>
            <button type="button" class="button_pump_now" style="padding:3px 6px;margin:0px">Pumpe an</button>
            <div id="cycle1_pump_duration_last" style="padding:12px 0 2px;font-size:80%;"></div>
            <div id="cycle1_pump_duration_total" style="padding:2px0 2px;font-size:80%;"></div>
          </div>
        </div>
        <br>
        <span class="nn" style="display: inline-flex;text-align: left;font-size:80%;">
          <label for="cycle1_next_check">Nächster check: </label>
          <div id="cycle1_next_check" style="padding:0px 0 0 6px;"></div>
        </span>
        <br>
        <div id="info_check_cycle1" style="display: inline-flex;padding-top: 12px;color:gray"></div>
        <br>
      </div>

      <div id="cycle2_group" class="noorder">
        <div class="line_named" >cycle2</div>
        <div style="display: inline-flex;">
          <div class="img-moisture">
            <p id="cycle2_moisture" style="margin-top:13px;padding-right:15px;font-size:120%;"></p>
          </div>
          <div class="img-flowerbox" style="margin:0px 10px 0 10px;">
            <p id="cycle2_flowerbox" style="margin-bottom:0;padding:28px 0 0 0;font-size:120%;"></p>
            <p id="cycle2_flowerbox_sensor" style="margin-top:-5px;font-size:60%;"></p>
          </div>
          <div class="img-canister">
            <p id="cycle2_canister" style="margin-bottom:0;padding:42px 0 0 0;font-size:120%;"></p>
            <p id="cycle2_canister_sensor" style="margin-top:-5px;font-size:60%;"></p>
          </div>
        </div>
        <br>
        <div style="display: inline-flex;padding:10px 0px 0px 0px;">
          <div class="img-pump"></div>
          <div>
            <div id="cycle2_pump_on" style="display:inline-flex;padding:2px 0 2px;font-size:120%;"></div>
            <button type="button" class="button_pump_now" style="padding:3px 6px;margin:0px">Pumpe an</button>
            <div id="cycle2_pump_duration_last" style="padding:12px 0 2px;font-size:80%;"></div>
            <div id="cycle2_pump_duration_total" style="padding:2px0 2px;font-size:80%;"></div>
          </div>
        </div>
        <br>
        <span class="nn" style="display: inline-flex;text-align: left;font-size:80%;">
          <label for="cycle2_next_check">Nächster check: </label>
          <div id="cycle2_next_check" style="padding:0px 0 0 6px;"></div>
        </span>
        <br>
        <div id="info_check_cycle2" style="display: inline-flex;padding-top: 12px;color:gray"></div>
        <br>
      </div>
      <br>
      <button type="button" class="button_check" > Jetzt prüfen</button>


    </div>
    <script>jsons = [ ["/bbs/state.json", "fillBssState"] ];</script>    
    <script src="/js/postload.js"></script>
    <script type="text/javascript">
      function setTrueFalse(elname, value, strTrue="Leer", colorTrue="red", strFalse="Voll", colorFalse="green") {
        element = document.getElementById(elname);
        if (element == undefined)
          return;
        if (value) {
          element.innerText = strTrue;
          element.style.color = colorTrue;
        } else {
          element.innerText = strFalse;
          element.style.color = colorFalse;
        }
      }

      function sec2str(value) {
        secs = value;
        hours = Math.floor(secs / 3600);
        secs %= 3600;
        minutes =  Math.floor(secs / 60);
        secs %= 60;
        result = '';
        if (hours > 0) { result += hours + 'h'; }
        if (minutes > 0) { result += minutes + 'm'; }
        if (secs > 0) { result += secs + 's'; }
        return result;
      }

      function updateCycle(cycle, data) {
        co = data[cycle];
        if (co["enabled"]) {
          document.getElementById(cycle+"_moisture").innerText = co["moisture"] + '%';
          setTrueFalse(cycle+"_flowerbox", co["flowerbox_empty"]);
          setTrueFalse(cycle+"_flowerbox_sensor", co["flowerbox_sensor"], "", "red", "kein Sensor", "gray");
          setTrueFalse(cycle+"_canister", co["canister_empty"]);
          setTrueFalse(cycle+"_canister_sensor", co["canister_sensor"], "", "red", "kein Sensor", "gray");
          document.getElementById("info_check_" + cycle).innerHTML = '<label id="info_check">' + co["check_info"] + "</label>";
          setTrueFalse(cycle+"_pump_on", co["pump_on"], "An", "green", "Aus", "grey");
          document.getElementById(cycle+"_pump_duration_last").innerHTML = "zuletzt: " + sec2str(co["pump_duration_last"]);
          document.getElementById(cycle+"_pump_duration_total").innerHTML = "gesamt: " + sec2str(co["pump_duration_total"]);
          document.getElementById(cycle+"_next_check").innerText = co["next_check"];
        } else {
          document.getElementById(cycle+"_group").remove();
        }
      }

      function fillBssState(data, url) {
        document.getElementById("bbs_title").innerText = data["name"];
        document.getElementById("version").innerText = 'v' + data["version"];
        updateCycle("cycle1", data);
        updateCycle("cycle2", data);
        // setTimeout(getJSON.bind(null, "/bbs/config.json", "fillBbsConfig"), 3000);
      }
    </script>
  </body>

</html>